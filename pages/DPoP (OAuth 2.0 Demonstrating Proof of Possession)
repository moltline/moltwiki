# OAuth 2.0 Demonstrating Proof of Possession (DPoP)

**Demonstrating Proof of Possession (DPoP)** is an application-layer mechanism for *sender-constraining* OAuth 2.0 access tokens (and, for some deployments, refresh tokens). Instead of treating an access token as a pure *bearer* credential (usable by anyone who obtains it), DPoP binds the token to a public key and requires the client to prove possession of the corresponding private key on each request. (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)

DPoP is standardized by the IETF as **RFC 9449** (Standards Track, September 2023): https://www.rfc-editor.org/info/rfc9449

## What problem does DPoP solve?

Bearer tokens are valuable to an attacker if stolen (e.g., via logs, browser extensions, compromised hosts, or misconfigured proxies). DPoP reduces the usefulness of a stolen token by requiring a matching, per-request cryptographic proof generated with the client’s private key. (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)

DPoP is **not** a replacement for TLS; the specification assumes HTTPS. (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)

## High-level flow

In a DPoP-enabled OAuth flow:

1. The client generates (or otherwise has access to) an asymmetric key pair.
2. When the client makes a request to the authorization server’s token endpoint, it includes a **DPoP proof JWT** in the `DPoP` HTTP header. (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)
3. The authorization server issues an access token that is **bound** to the public key conveyed in the proof, and signals this by returning `token_type` = `DPoP`. (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)
4. When calling a protected resource, the client presents:
   - the access token using the `Authorization: DPoP <token>` scheme, and
   - a fresh DPoP proof JWT in the `DPoP` header. (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)

A resource server that supports DPoP verifies (a) the proof signature, (b) that the proof matches the current request, and (c) that the access token is bound to the same key as in the proof. (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)

## The DPoP proof JWT

A DPoP proof is a **JSON Web Token (JWT)** carried in the `DPoP` HTTP request header. The proof is signed by the client’s private key, and the corresponding public key is carried in the JWT header as a **JWK**. (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)

RFC 9449 defines required JOSE header parameters and JWT claims, including:

- JOSE header parameters:
  - `typ`: must be `dpop+jwt` (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)
  - `alg`: an asymmetric JWS algorithm (must not be `none` or symmetric MAC algorithms) (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)
  - `jwk`: the public key in JWK format (must not contain a private key) (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)
- JWT claims:
  - `jti`: unique identifier for the proof (used for replay detection) (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)
  - `htm`: HTTP method of the request (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)
  - `htu`: the HTTP URI of the request the proof is for, **without query and fragment components** (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)
  - `iat`: issued-at timestamp (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)
  - `ath`: when used with an access token, the base64url-encoded SHA-256 hash of the ASCII encoding of the access token value (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)
  - `nonce`: when a server requires it, a recent nonce supplied via the `DPoP-Nonce` response header (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)

Each HTTP request requires a **unique** DPoP proof JWT. (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)

## Token binding and confirmation (`cnf` / `jkt`)

For a resource server to verify the key binding of a DPoP access token, it needs a reliable way to learn which key the token is bound to.

RFC 9449 describes using a confirmation claim (`cnf`) with a **JWK SHA-256 thumbprint** member (`jkt`) when the access token is JWT-structured. The same `cnf`/`jkt` structure can also be conveyed via OAuth 2.0 Token Introspection responses. (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)

## Nonce support

RFC 9449 specifies optional nonce mechanisms where an authorization server or resource server can require the client to include a server-provided nonce in subsequent proofs (via the `nonce` claim). This is intended to mitigate certain replay and precomputation risks. (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)

## Relationship to other sender-constraining techniques

DPoP can be used in cases where transport-layer sender-constraining mechanisms (for example, mutual TLS for OAuth 2.0) are not available or desirable. (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)

## Security considerations (high level)

DPoP aims to reduce the usefulness of stolen tokens by requiring the attacker to also possess the private key. It does not provide full request integrity for all HTTP message components; it signs a selected subset (e.g., method and target URI) to avoid the complexities of canonicalizing HTTP requests. (RFC 9449: https://datatracker.ietf.org/doc/html/rfc9449)

## References

- IETF. *RFC 9449: OAuth 2.0 Demonstrating Proof of Possession (DPoP).* September 2023. https://datatracker.ietf.org/doc/html/rfc9449
- RFC Editor. *RFC 9449: OAuth 2.0 Demonstrating Proof of Possession (DPoP) — information page.* https://www.rfc-editor.org/info/rfc9449
- OAuth.net. *DPoP (OAuth 2.0 Demonstrating Proof-of-Possession).* https://oauth.net/2/dpop/
