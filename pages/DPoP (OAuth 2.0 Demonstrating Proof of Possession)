# OAuth 2.0 Demonstrating Proof of Possession (DPoP)

**Demonstrating Proof of Possession (DPoP)** is an OAuth 2.0 extension for *sender-constraining* access tokens at the application layer: the token is bound to a client-held public key, and the client must prove possession of the corresponding private key on each request. This reduces the impact of access token theft and replay compared to pure bearer tokens.

DPoP is standardized by the IETF as **RFC 9449** (Standards Track, September 2023). https://datatracker.ietf.org/doc/html/rfc9449

## How it works (high level)

In a DPoP-enabled OAuth flow:

1. The client generates (or otherwise has access to) an asymmetric key pair.
2. When the client requests a token, it includes a **DPoP proof** JWT in the `DPoP` HTTP header. https://datatracker.ietf.org/doc/html/rfc9449
3. The authorization server issues an access token that is bound to the public key conveyed in the proof and indicates this by returning `token_type` = `DPoP`. https://datatracker.ietf.org/doc/html/rfc9449
4. When calling a protected resource, the client sends:
   - the access token using the `Authorization: DPoP <token>` scheme, and
   - a fresh DPoP proof in the `DPoP` header. https://datatracker.ietf.org/doc/html/rfc9449

A resource server that supports DPoP verifies (a) the proof signature, (b) that the proof is for the current request, and (c) that the access token is bound to the same key as in the proof. https://datatracker.ietf.org/doc/html/rfc9449

## The DPoP proof JWT

A DPoP proof is a **JSON Web Token (JWT)** carried in the `DPoP` HTTP request header. The proof is signed by the client’s private key; the corresponding public key is carried in the JWT header as a **JWK**. https://datatracker.ietf.org/doc/html/rfc9449

### JOSE header requirements

RFC 9449 defines required JOSE header parameters, including:

- `typ`: must be `dpop+jwt` https://datatracker.ietf.org/doc/html/rfc9449
- `alg`: an asymmetric JWS algorithm (must not be `none` or symmetric MAC algorithms) https://datatracker.ietf.org/doc/html/rfc9449
- `jwk`: the public key in JWK format (must not contain a private key) https://datatracker.ietf.org/doc/html/rfc9449

### Claim requirements

Required/defined claims include:

- `jti`: unique identifier for the proof (used for replay detection) https://datatracker.ietf.org/doc/html/rfc9449
- `htm`: HTTP method of the request https://datatracker.ietf.org/doc/html/rfc9449
- `htu`: HTTP target URI of the request, **without query and fragment parts** https://datatracker.ietf.org/doc/html/rfc9449
- `iat`: issued-at timestamp https://datatracker.ietf.org/doc/html/rfc9449
- `ath`: when used with an access token, base64url-encoded SHA-256 hash of the ASCII encoding of the access token value https://datatracker.ietf.org/doc/html/rfc9449
- `nonce`: when a server requires it, a recent nonce supplied via the `DPoP-Nonce` response header https://datatracker.ietf.org/doc/html/rfc9449

Each HTTP request requires a **unique** DPoP proof JWT (e.g., distinct `jti` values). https://datatracker.ietf.org/doc/html/rfc9449

## Token binding (`cnf` / `jkt`)

For a resource server to verify key-binding of a DPoP access token, it needs a reliable way to learn which key the token is bound to.

RFC 9449 describes using a confirmation claim (`cnf`) with a **JWK SHA-256 thumbprint** member (`jkt`) when the access token is JWT-structured; the same `cnf`/`jkt` structure can also be conveyed via OAuth 2.0 Token Introspection responses. https://datatracker.ietf.org/doc/html/rfc9449

## Nonce support

RFC 9449 specifies an optional nonce mechanism where an authorization server or resource server can require the client to include a server-provided nonce in subsequent proofs (via the `nonce` claim). This is intended to mitigate certain replay and precomputation risks. https://datatracker.ietf.org/doc/html/rfc9449

## Relationship to other sender-constraining techniques

DPoP is often positioned as an application-layer alternative for environments where transport-layer sender-constraining mechanisms (for example, mutual TLS for OAuth) are not available or desirable. https://datatracker.ietf.org/doc/html/rfc9449

## Security notes (high level)

- DPoP is specified for use with HTTPS; it is not a substitute for transport security. https://datatracker.ietf.org/doc/html/rfc9449
- DPoP does not provide full request integrity for all HTTP message components; it signs a selected subset (method and target URI) to avoid the complexities of canonicalizing complete HTTP requests. https://datatracker.ietf.org/doc/html/rfc9449

## References

- IETF. *RFC 9449: OAuth 2.0 Demonstrating Proof of Possession (DPoP).* September 2023. https://datatracker.ietf.org/doc/html/rfc9449
- RFC Editor. *RFC 9449: OAuth 2.0 Demonstrating Proof of Possession (DPoP) — information page.* https://www.rfc-editor.org/info/rfc9449
- OAuth.net. *DPoP (OAuth 2.0 Demonstrating Proof-of-Possession).* https://oauth.net/2/dpop/
